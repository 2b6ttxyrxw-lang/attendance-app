<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å‡ºé€€å‹¤æ‰“åˆ»</title>
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#0f766e" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background:#f6f7f9; color:#111; }
    header { background:#0f766e; color:#fff; padding:16px; text-align:center; }
    main { max-width:560px; margin:24px auto; padding:16px; }
    .card { background:#fff; border-radius:16px; padding:20px; box-shadow: 0 4px 18px rgba(0,0,0,.06); }
    .row { display:flex; gap:12px; flex-wrap:wrap; margin-top:12px; }
    button { flex:1; padding:14px 16px; border:0; border-radius:12px; font-size:16px; cursor:pointer; box-shadow: 0 2px 8px rgba(0,0,0,.08); }
    .btn-in { background:#10b981; color:#fff; }
    .btn-out { background:#ef4444; color:#fff; }
    .btn-done { background:#3b82f6; color:#fff; width:100%; }
    .field { display:flex; flex-direction:column; gap:6px; margin-top:8px; }
    input, select { padding:12px; border:1px solid #e5e7eb; border-radius:10px; }
    .hint { color:#6b7280; font-size:12px; }
    .toast { position: fixed; left:50%; transform: translateX(-50%); bottom:24px; background:#111; color:#fff; padding:12px 16px; border-radius:10px; opacity:0; transition:.25s; }
    .toast.show { opacity:1; }
    footer { text-align:center; color:#6b7280; font-size:12px; margin:24px 0 12px; }
  </style>
</head>
<body>
  <header><h1>å‡ºé€€å‹¤æ‰“åˆ» / Attendance</h1></header>
  <main>
    <div class="card">
      <div class="field">
        <label>ç ”ä¿®ç”ŸID / Trainee ID</label>
        <input id="traineeId" placeholder="ä¾‹: user01" value="user01" />
      </div>
      <div class="field">
        <label>æ°å / Name</label>
        <input id="name" placeholder="ä¾‹: å±±ç”°å¤ªéƒ" />
        <div class="hint">â€» ç ”ä¿®ç”Ÿãƒã‚¹ã‚¿ã¨ä¸€è‡´ã•ã›ã¦ãã ã•ã„</div>
      </div>

      <div class="row">
        <button id="btnIn" class="btn-in">å‡ºå‹¤</button>
        <button id="btnOut" class="btn-out">é€€å‹¤</button>
      </div>

      <div class="field" style="margin-top:16px;">
        <label>ã‚¢ãƒ—ãƒªURLï¼ˆå®Œäº†å ±å‘Šç”¨ï¼‰</label>
        <input id="appUrl" placeholder="https://your-github-username.github.io/attendance-app" />
      </div>
      <div class="row">
        <button id="btnDone" class="btn-done">ğŸ‰ èª²é¡Œå®Œäº†å ±å‘Š</button>
      </div>
      <p class="hint">ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹ã¨ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ãˆã¾ã™ï¼ˆPWAï¼‰ã€‚</p>
    </div>
  </main>

  <div id="toast" class="toast">é€ä¿¡ã—ã¾ã—ãŸ</div>
  <footer>Â© 2025 Attendance App</footer>

 <!-- ç½®ãæ›ãˆå…ˆ -->
<script>
 const APP_ENDPOINT = "https://script.google.com/macros/s/AKfycbzIbsZliIJKw979Fp7kRIT1DdNCIq83Ka-DCC-jOWQWCd-sFdAyqSQHxTeR1d17n7t4-g/exec";

</script>

    // é€£æ‰“é˜²æ­¢
    let busy = false;
    const toast = (msg) => { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(()=> t.classList.remove('show'), 1800); };

    const postNoCors = (payload) => fetch(APP_ENDPOINT, { method: "POST", mode: "no-cors", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });

    const getCommon = () => {
      const traineeId = document.getElementById('traineeId').value.trim();
      const name = document.getElementById('name').value.trim();
      if (!traineeId || !name) throw new Error("ç ”ä¿®ç”ŸIDã¨æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return { traineeId, name };
    };

    document.getElementById('btnIn').addEventListener('click', async () => {
      if (busy) return; busy = true;
      try {
        const { traineeId, name } = getCommon();
        await postNoCors({ action: "clockIn", traineeId, name });
        toast("å‡ºå‹¤ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ˆLINEã¸é€šçŸ¥ & è¨˜éŒ²ï¼‰");
      } catch (e) { toast(e.message); }
      finally { busy = false; }
    });

    document.getElementById('btnOut').addEventListener('click', async () => {
      if (busy) return; busy = true;
      try {
        const { traineeId, name } = getCommon();
        await postNoCors({ action: "clockOut", traineeId, name });
        toast("é€€å‹¤ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ˆLINEã¸é€šçŸ¥ & è¨˜éŒ²ï¼‰");
      } catch (e) { toast(e.message); }
      finally { busy = false; }
    });

    document.getElementById('btnDone').addEventListener('click', async () => {
      if (busy) return; busy = true;
      try {
        const { traineeId, name } = getCommon();
        const appUrl = document.getElementById('appUrl').value.trim();
        if (!appUrl) throw new Error("ã‚¢ãƒ—ãƒªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        await postNoCors({ action: "reportDone", traineeId, name, appUrl });
        toast("èª²é¡Œå®Œäº†ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ˆLINEã¸é€šçŸ¥ & è¨˜éŒ²ï¼‰");
      } catch (e) { toast(e.message); }
      finally { busy = false; }
    });

    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./service-worker.js");
      });
    }
  </script>
</body>
</html>
